{{#if key}}
	{{#if deck}}
		{{#if currentCard}}
			<div class="card">
				<h2>
					{{card.prompt}}
				</h2>
				<p>
					{{card.answer}}
				</p>
			</div>
		{{else}}
			<h1>No card #{{currentNumber}} found!</h1>
		{{/if}}
	{{else}}
		Loading sheet {{key}}...
	{{/if}}
{{else}}
	<input type="text" bind:value="sheetUrl" on:change="loadSheet(sheetUrl)">
{{/if}}

<Link parameters="{{ { number: nextNumber } }}">Next</Link>

<style>
	.card {
		width: 100%;
	}
</style>

<script>
import querystringRouter from 'svelte-querystring-router'
import sheetsy from 'sheetsy'

const { Link, navigate } = querystringRouter
const { urlToKey, getSheetList, getSheet } = sheetsy

export default {
	data() {
		return {
		}
	},
	computed: {
		currentNumber: querystringParameters => {
			const number = parseInt(querystringParameters.number, 10)
			return Number.isNaN(number) ? 1 : number
		},
		index: currentNumber => currentNumber - 1,
		nextNumber: currentNumber => currentNumber + 1,
		currentCard: (deck, index) => deck && deck[index] && null
	},
	components: {
		Link
	},
	methods: {
		loadSheet(url) {
			const key = urlToKey(url)
			navigate({
				parameters: { key },
				// replace: true
			})
		}
	}
}
</script>
