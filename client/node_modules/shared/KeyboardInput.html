<input
	ref:input
	type="text"
	bind:value="contents"
	on:input="onInput(contents)"
/>

<script>
const endsInWhitespaceRegex = /\s+$/
export default {
	data() {
		return {
			contents: '',
			emitCharacters: true
		}
	},
	computed: {
		trimmed: contents => contents.trim()
	},
	methods: {
		clear() {
			this.set({
				contents: ''
			})
		},
		fireInput() {
			this.fire('input', this.get('trimmed'))
			this.clear()
		},
		onInput(contents) {
			const emitCharacters = this.get('emitCharacters')

			// Either it emits characters, or it emits words
			// (anything non-whitespace)
			if (emitCharacters) {
				const trimmed = contents.trim()
				if (trimmed) {
					this.fireInput()
				} else {
					this.clear()
				}
			} else if (endsInWhitespaceRegex.test(contents)) {
				this.fireInput()
			}
		},
		focus() {
			this.refs.input.focus()
		},
	},
}
</script>
