(function(){"use strict";/**
	 * Escape the capturing group by escaping special characters and meaning.
	 *
	 * @param  {String} group
	 * @return {String}
	 */function e(e){return e.replace(/([=!:$\/()])/g,"\\$1")}/**
	 * Attach the keys as a property of the regexp.
	 *
	 * @param  {RegExp} re
	 * @param  {Array}  keys
	 * @return {RegExp}
	 */function t(e,t,n){return e.keys=t,e.allTokens=n,e}/**
	 * Get the flags for a regexp from the options.
	 *
	 * @param  {Object} options
	 * @return {String}
	 */function n(e){return e.sensitive?"":"i"}/**
	 * Pull out keys from a regexp.
	 *
	 * @param  {RegExp} path
	 * @param  {Array}  keys
	 * @return {RegExp}
	 */function a(e,n,a){// Use a negative lookahead to match only capturing groups.
var r=e.source.match(/\((?!\?)/g);if(r)for(var s=0;s<r.length;s++)n.push({name:s,delimiter:null,optional:!1,repeat:!1});return t(e,n,a)}/**
	 * Transform an array into a regexp.
	 *
	 * @param  {Array}  path
	 * @param  {Array}  keys
	 * @param  {Object} options
	 * @return {RegExp}
	 */function r(e,a,r,s){for(var d=[],l=0;l<e.length;l++)d.push(o(e[l],a,r,s).source);var c=new RegExp("(?:"+d.join("|")+")",n(r));return t(c,a,s)}/**
	 * Replace the specific tags with regexp strings.
	 *
	 * @param  {String} path
	 * @param  {Array}  keys
	 * @return {String}
	 */function s(t,n,a){function r(e){0===i&&"/"!==e[0]&&(e="/"+e),a.push({string:e})}function s(s,d,l,c,u,m,h,p,f){if(d)return d;if(p)return"\\"+p;var g="+"===h||"*"===h,y="?"===h||"*"===h;f>i&&r(t.substring(i,f)),i=f+s.length;var v={name:c||o++,delimiter:l||"/",optional:y,repeat:g};return n.push(v),a.push(v),l=l?"\\"+l:"",u=e(u||m||"[^"+(l||"\\/")+"]+?"),g&&(u=u+"(?:"+l+u+")*"),y?"(?:"+l+"("+u+"))?":l+"("+u+")";// Basic parameter support.
}var o=0,i=0,d=t.replace(Ve,s);return i<t.length&&r(t.substring(i)),d}/**
	 * Normalize the given path string, returning a regular expression.
	 *
	 * An empty array can be passed in for the keys, which will hold the
	 * placeholder key descriptions. For example, using `/user/:id`, `keys` will
	 * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.
	 *
	 * @param  {(String|RegExp|Array)} path
	 * @param  {Array}                 [keys]
	 * @param  {Object}                [options]
	 * @return {RegExp}
	 */function o(e,o,i,d){if(o=o||[],d=d||[],He(o)?!i&&(i={}):(i=o,o=[]),e instanceof RegExp)return a(e,o,i,d);if(He(e))return r(e,o,i,d);var l=i.strict,c=!1!==i.end,u=s(e,o,d),m="/"===e.charAt(e.length-1);return l||(u=(m?u.slice(0,-2):u)+"(?:\\/(?=$))?"),u+=c?"$":l&&m?"":"(?=\\/|$)",t(new RegExp("^"+u,n(i)),o,d)}function i(e,t){return t={exports:{}},e(t,t.exports),t.exports}function d(e){if(null===e||e===void 0)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function l(e){switch(e.arrayFormat){case"index":return function(t,n,a){return null===n?[u(t,e),"[",a,"]"].join(""):[u(t,e),"[",u(a,e),"]=",u(n,e)].join("")};case"bracket":return function(t,n){return null===n?u(t,e):[u(t,e),"[]=",u(n,e)].join("")};default:return function(t,n){return null===n?u(t,e):[u(t,e),"=",u(n,e)].join("")};}}function c(e){var t;switch(e.arrayFormat){case"index":return function(e,n,a){return t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?void(void 0===a[e]&&(a[e]={}),a[e][t[1]]=n):void(a[e]=n)};case"bracket":return function(e,n,a){return(t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),!t)?void(a[e]=n):void 0===a[e]?void(a[e]=[n]):void(a[e]=[].concat(a[e],n))};default:return function(e,t,n){return void 0===n[e]?void(n[e]=t):void(n[e]=[].concat(n[e],t))};}}function u(e,t){return t.encode?t.strict?Re(e):encodeURIComponent(e):e}function m(e){if(Array.isArray(e))return e.sort();return"object"==typeof e?m(Object.keys(e)).sort(function(e,t){return+e-+t}).map(function(t){return e[t]}):e}function h(e,t){e.location.replace(p(e.location.href)+"#"+t)}function p(e){var t=e.indexOf("#");return-1===t?e:e.substring(0,t)}function f(e,t){e.location.hash=t}function g(e,t){var n=y(e.location.hash);return t?decodeURI(n):n}function y(e){return e&&"#"===e[0]?e.substr(1):e}function v(){var e=document.createElement("a");return e.href="#x x",!/x x/.test(e.hash)}function k(e,t,n,a){_(e,E(t.get()),n,a)}function b(e){var t=e.split("?");return{path:t.shift(),queryString:Me.parse(t.join(""))}}function _(e,t,n,a){var r=b(t);t=r.path;var s=r.queryString,o=P(n?w(e):e,t);if(o){var i=o.exec(t),d=x(o.keys,i),l=Ge(s,d);o.fn(l)}else a(t,s)}function w(e){return e.slice().reverse()}function x(e,t){return e.reduce(function(e,n,a){return e[n.name]=t[a+1],e},{})}function C(e,t,n){if("function"!=typeof n)throw new Error("The router add function must be passed a callback function");var a=De(t);a.fn=n,e.push(a)}function A(e,t,n,a,r){var s=E(t.get());if(s&&("/"!==s||"/"===r)){var o=e.slice();k(o,t,n,a)}else t.go(r)}function E(e){var t=e.match(Xe);return t?t[1]:""}function S(e){return e&&e.go&&e.replace&&e.on}function P(e,t){for(var n=0;n<e.length;++n)if(t.match(e[n]))return e[n]}// This file to be replaced with an official implementation maintained by
// the page.js crew if and when that becomes an option
function N(e,t,n){var a=L(t,n);return 0===Object.keys(a).length?e:e+"?"+et(a)}function L(e,t){var n=t.reduce(function(e,t){return t.string||(e[t.name]=t),e},{});return Object.keys(e).filter(function(e){return!n[e]}).reduce(function(t,n){return t[n]=e[n],t},{})}function T(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}function I(){var e={};return function(t){return t?(e[t]||(e[t]=nt(t).keys.map(function(e){return e.name})),e[t]):[]}}function j(e){var t=e.stateState,n=e.getPathParameters,a=e.stateName,r=e.fromParameters,s=e.toParameters,o=t.get(a),i=o.querystringParameters||[],d=n(o.route).concat(i);return Array.isArray(d)&&d.some(function(e){return r[e]!==s[e]})}function z(e){var t=e.parametersChanged,n=e.original,a=e.destination,r=tt({start:dt(n.name),end:dt(a.name)});return r.map(function(e){var r=e.start,s=e.end;return{nameBefore:r,nameAfter:s,stateNameChanged:r!==s,stateParametersChanged:r===s&&t({stateName:r,fromParameters:n.parameters,toParameters:a.parameters})}})}function O(e,t){var n=dt(t);return n.filter(function(t){return e[t]}).reduce(function(t,n){return ct(t,e[n])},{})}function W(e,t){return{redirectTo:{name:e,params:t}}}// { [stateName]: resolveResult }
function F(e,t){var n=e.filter(bt("resolve")),a=n.map(vt("name")),r=Promise.all(n.map(function(e){return new Promise(function(n,a){var r=function(e,t){return e?a(e):n(t)};r.redirect=function(e,t){a(W(e,t))};var s=e.resolve(e.data,t,r);_t(s)&&n(s)})}));return r.then(function(e){return tt({stateName:a,resolveResult:e}).reduce(function(e,t){return e[t.stateName]=t.resolveResult,e},{})})}function H(e,t,n){// const coolPrototype = Object.assign(Object.create(Component.prototype), methods)
// return Component.call(coolPrototype, options)
return Object.assign(new e(t),n)}function D(e,t){return e.push(t),function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}}function V(){}function Q(e,t){for(var n in t)e[n]=t[n];return e}function B(e,t){e.appendChild(t)}function R(e,t,n){e.insertBefore(t,n)}function U(e){e.parentNode.removeChild(e)}function q(e,t){for(var n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function K(e){return document.createElement(e)}function $(e){return document.createTextNode(e)}function M(e,t,n,a){e.addEventListener(t,n,a)}function G(e,t,n,a){e.removeEventListener(t,n,a)}function Y(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function J(e,t){e.data=""+t}function X(e,t,n){e.style.setProperty(t,n)}function Z(){return Object.create(null)}function ee(e,t){var n=e in this._handlers&&this._handlers[e].slice();if(n)for(var a,r=0;r<n.length;r+=1)if(a=n[r],!a.__calling)try{a.__calling=!0,a.call(this,t)}finally{a.__calling=!1}}function te(e){e._lock=!0,ae(e._beforecreate),ae(e._oncreate),ae(e._aftercreate),e._lock=!1}function ne(e,t){e._handlers=Z(),e._slots=Z(),e._bind=t._bind,e._staged={},e.options=t,e.root=t.root||e,e.store=t.store||e.root.store,t.root||(e._beforecreate=[],e._oncreate=[],e._aftercreate=[])}function ae(e){for(;e&&e.length;)e.shift()()}function re(e){return 200<=e.status&&400>e.status}function se(e){return JSON.stringify(e)}function oe(e){return JSON.parse(e.responseText)}function ie(){return{sheetUrl:``}}function de(e,t){function n(){x=!0,e.set({sheetUrl:u.value}),x=!1}function r(){e.loadSheet(t.sheetUrl)}var s,o,i,d,l,c,u,m,h,f,g,y,v,k,b,_,w,x=!1,C=t.error&&le(e,t);return{c(){s=K("div"),o=K("div"),i=K("h1"),i.textContent="Memorize Text",d=$("\n\n\t\t"),l=K("label"),c=$("Google Sheets share link\n\t\t\t"),u=K("input"),m=$("\n\n\t\t"),h=K("hr"),f=$("\n\n\t\t"),g=K("p"),y=K("a"),v=$("Try an example deck"),b=$("\n\n\t\t"),C&&C.c(),_=$("\n\t"),w=K("div"),w.innerHTML=`<a href="https://github.com/TehShrike/memorize-text-app/">Github</a>`,M(u,"input",n),M(u,"change",r),Y(u,"type","text"),u.placeholder="https://docs.google.com/spreadsheets/d/1C6EBjsS-FY6KPzKnHCVFEcpYy_Gh_bvAJWcma50Qwrw/edit?usp=sharing",y.href=k=t.asr.makePath("workbook",{key:"1C6EBjsS-FY6KPzKnHCVFEcpYy_Gh_bvAJWcma50Qwrw"}),o.className="content",w.className="footer",s.className="container"},m(e,n){R(e,s,n),B(s,o),B(o,i),B(o,d),B(o,l),B(l,c),B(l,u),u.value=t.sheetUrl,B(o,m),B(o,h),B(o,f),B(o,g),B(g,y),B(y,v),B(o,b),C&&C.m(o,null),B(s,_),B(s,w)},p(n,a){t=a,!x&&n.sheetUrl&&(u.value=t.sheetUrl),n.asr&&k!==(k=t.asr.makePath("workbook",{key:"1C6EBjsS-FY6KPzKnHCVFEcpYy_Gh_bvAJWcma50Qwrw"}))&&(y.href=k),t.error?C?C.p(n,t):(C=le(e,t),C.c(),C.m(o,null)):C&&(C.d(1),C=null)},d(e){e&&U(s),G(u,"input",n),G(u,"change",r),C&&C.d()}}}// (21:2) {#if error}
function le(e,t){var n,a,r;return{c(){n=K("div"),a=$("Error: "),r=$(t.error),X(n,"color","var(--red)")},m(e,t){R(e,n,t),B(n,a),B(n,r)},p(e,t){e.error&&J(r,t.error)},d(e){e&&U(n)}}}function ce(e){ne(this,e),this._state=Q(ie(),e.data),this._intro=!0,this._fragment=de(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}/* client/view/not-found/NotFound.html generated by Svelte v2.16.0 */function ue(e,t){var n,r,s,o,i,d,l,c=t.route&&me(e,t);return{c(){n=K("h1"),n.textContent="Page not found",r=$("\n"),c&&c.c(),s=$("\n"),o=K("p"),i=K("a"),d=$("Home"),i.href=l=t.asr.makePath("index")},m(e,t){R(e,n,t),R(e,r,t),c&&c.m(e,t),R(e,s,t),R(e,o,t),B(o,i),B(i,d)},p(t,n){n.route?c?c.p(t,n):(c=me(e,n),c.c(),c.m(s.parentNode,s)):c&&(c.d(1),c=null),t.asr&&l!==(l=n.asr.makePath("index"))&&(i.href=l)},d(e){e&&(U(n),U(r)),c&&c.d(e),e&&(U(s),U(o))}}}// (2:0) {#if route}
function me(e,t){var n,a,r,s;return{c(){n=K("div"),a=$("Can't match route:"),r=K("pre"),s=$(t.route)},m(e,t){R(e,n,t),B(n,a),B(n,r),B(r,s)},p(e,t){e.route&&J(s,t.route)},d(e){e&&U(n)}}}function he(e){ne(this,e),this._state=Q({},e.data),this._intro=!0,this._fragment=ue(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}/* client/view/workbook/Workbook.html generated by Svelte v2.16.0 */function pe(){var e;return{c(){e=K("uiView")},m(t,n){R(t,e,n)},p:V,d(t){t&&U(e)}}}function fe(e){ne(this,e),this._state=Q({},e.data),this._intro=!0,this._fragment=pe(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}/* client/view/workbook/select-sheet/SelectSheet.html generated by Svelte v2.16.0 */function ge(e,t,n){const a=Object.create(e);return a.sheet=t[n],a}function ye(e,t){function n(e){return 1===e.workbook.sheets.length?ke:ve}var a,r,s,o,i,d=t.workbook.name,l=n(t),c=l(e,t);return{c(){a=K("div"),r=K("div"),s=K("h1"),o=$(d),i=$("\n\n\t\t"),c.c(),r.className="content",a.className="container"},m(e,t){R(e,a,t),B(a,r),B(r,s),B(s,o),B(r,i),c.m(r,null)},p(t,a){t.workbook&&d!==(d=a.workbook.name)&&J(o,d),l===(l=n(a))&&c?c.p(t,a):(c.d(1),c=l(e,a),c.c(),c.m(r,null))},d(e){e&&U(a),c.d()}}}// (9:2) {:else}
function ve(e,t){for(var n,a=t.workbook.sheets,r=[],s=0;s<a.length;s+=1)r[s]=be(e,ge(t,a,s));return{c(){n=K("ol");for(var e=0;e<r.length;e+=1)r[e].c()},m(e,t){R(e,n,t);for(var a=0;a<r.length;a+=1)r[a].m(n,null)},p(t,s){if(t.asr||t.workbook||t.key){a=s.workbook.sheets;for(var o=0;o<a.length;o+=1){const i=ge(s,a,o);r[o]?r[o].p(t,i):(r[o]=be(e,i),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=a.length}},d(e){e&&U(n),q(r,e)}}}// (5:2) {#if workbook.sheets.length === 1}
function ke(e,t){var n,a,r,s,o=t.workbook.sheets[0].name;return{c(){n=K("p"),a=$("Loading "),r=$(o),s=$("..."),X(n,"text-align","center")},m(e,t){R(e,n,t),B(n,a),B(n,r),B(n,s)},p(e,t){e.workbook&&o!==(o=t.workbook.sheets[0].name)&&J(r,o)},d(e){e&&U(n)}}}// (11:4) {#each workbook.sheets as sheet}
function be(e,t){var n,r,s,o,i,d,l,c=t.sheet.name;return{c(){n=K("li"),r=$(c),s=$(" -\n\t\t\t\t\t\t"),o=K("a"),i=$("memorize"),l=$("\n\t\t\t\t\t"),o.href=d=t.asr.makePath("workbook.sheet.memorize",{sheetId:t.sheet.id,key:t.key})},m(e,t){R(e,n,t),B(n,r),B(n,s),B(n,o),B(o,i),B(n,l)},p(e,t){e.workbook&&c!==(c=t.sheet.name)&&J(r,c),(e.asr||e.workbook||e.key)&&d!==(d=t.asr.makePath("workbook.sheet.memorize",{sheetId:t.sheet.id,key:t.key}))&&(o.href=d)},d(e){e&&U(n)}}}function _e(e){ne(this,e),this._state=Q({},e.data),this._intro=!0,this._fragment=ye(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}/* client/view/workbook/sheet/Sheet.html generated by Svelte v2.16.0 */function we(){var e;return{c(){e=K("uiView")},m(t,n){R(t,e,n)},p:V,d(t){t&&U(e)}}}function xe(e){ne(this,e),this._state=Q({},e.data),this._intro=!0,this._fragment=we(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}/* client/view/workbook/sheet/memorize/Memorize.html generated by Svelte v2.16.0 */function Ce({currentQuestionPosition:e,sheet:t}){const n=t.rows[e];return n?{prompt:n[0],answer:n[1]}:null}function Ae({sheet:e}){return e.rows.length}function Ee({sheet:e,workbook:t}){return`Sheet1`===e.name?t.name:`${t.name} · ${e.name}`}function Se({currentCard:e}){return e.answer.split(/\s+/g)}function Pe({hintLevel:e}){return 0===e?0:3+5*(e-1)}function Ne({answerIsFullyVisible:e,currentCard:t,answerWords:n,numberOfHintWords:a}){return e?t.answer:n.slice(0,a).join(` `)}function Le({answerIsFullyVisible:e,answerWords:t,numberOfHintWords:n}){return e?``:t.slice(n).join(` `)}function Te({answerIsFullyVisible:e,numberOfHintWords:t,answerWords:n}){return!e&&t<n.length}function Ie(){return{currentQuestionPosition:0,sheet:null,answerIsFullyVisible:!1,hintLevel:0}}function je(){var e=K("style");e.id="svelte-123h2zb-style",e.textContent="[data-hidden=true].svelte-123h2zb{visibility:hidden}.key-identifier.svelte-123h2zb{font-family:sans-serif;background-color:var(--gray);color:var(--white);padding:2px 4px;border-radius:2px}.faint.svelte-123h2zb{color:var(--lightBlack)}.box.svelte-123h2zb{padding:32px;margin:32px 8px;border-radius:5px;box-shadow:0 0 8px 4px var(--lightGray)}.footer.svelte-123h2zb{display:flex;justify-content:space-between}@media(max-width: 600px){.footer.svelte-123h2zb{flex-direction:column}.footer.svelte-123h2zb .svelte-123h2zb{flex-basis:1.8rem}}.footer.svelte-123h2zb .svelte-123h2zb{text-align:center}.footer-center.svelte-123h2zb{flex-grow:1}.footer-left.svelte-123h2zb,.footer-right.svelte-123h2zb{flex-basis:64px}.nowrap.svelte-123h2zb{white-space:nowrap}",B(document.head,e)}function ze(e,t){function n(t){e.keydown(t)}function r(e){return 0===e.sheet.rows.length?We:Oe}var s,o,i,d,l,c,u,m,h,p,f,g,y,v,k,b,_,w,x=t.currentQuestionPosition+1;window.addEventListener("keydown",n);var C=r(t),A=C(e,t);return{c(){s=K("div"),o=K("div"),i=K("h1"),d=$(t.displayHeader),l=$("\n\n\t\t"),A.c(),c=$("\n\n\t"),u=K("div"),m=K("div"),h=K("a"),p=$("Home"),g=$("\n\t\t"),y=K("div"),y.innerHTML=`<span class="key-identifier svelte-123h2zb">[Spacebar]</span> Advance
						·
						<span class="key-identifier svelte-123h2zb">h</span> Show more hint
					`,v=$("\n\t\t"),k=K("div"),b=$(x),_=$(" / "),w=$(t.cardsInSheet),X(i,"font-size","1rem"),X(i,"text-align","center"),o.className="content",h.href=f=t.asr.makePath("index"),h.className="svelte-123h2zb",m.className="footer-left svelte-123h2zb",y.className="faint footer-center svelte-123h2zb",k.className="faint footer-right nowrap svelte-123h2zb",u.className="footer svelte-123h2zb",s.className="container"},m(e,t){R(e,s,t),B(s,o),B(o,i),B(i,d),B(o,l),A.m(o,null),B(s,c),B(s,u),B(u,m),B(m,h),B(h,p),B(u,g),B(u,y),B(u,v),B(u,k),B(k,b),B(k,_),B(k,w)},p(t,n){t.displayHeader&&J(d,n.displayHeader),C===(C=r(n))&&A?A.p(t,n):(A.d(1),A=C(e,n),A.c(),A.m(o,null)),t.asr&&f!==(f=n.asr.makePath("index"))&&(h.href=f),t.currentQuestionPosition&&x!==(x=n.currentQuestionPosition+1)&&J(b,x),t.cardsInSheet&&J(w,n.cardsInSheet)},d(e){window.removeEventListener("keydown",n),e&&U(s),A.d()}}}// (11:2) {:else}
function Oe(e,t){var n,a,r,s,o,i,d,l,c,u,m,h,p=t.currentCard.prompt;return{c(){n=K("div"),a=K("strong"),r=$(p),s=$("\n\n\t\t\t"),o=K("div"),i=$(t.visibleAnswer),d=K("span"),l=$("\u2026"),u=$("\n\n\t\t\t\t"),m=K("span"),h=$(t.hiddenAnswer),n.className="box svelte-123h2zb",d.dataset.hidden=c=0===t.hintLevel||!t.wordsAreLeftToDisplay,X(d,"color","var(--gray)"),d.className="svelte-123h2zb",X(m,"visibility","hidden"),o.className="box svelte-123h2zb"},m(e,t){R(e,n,t),B(n,a),B(a,r),R(e,s,t),R(e,o,t),B(o,i),B(o,d),B(d,l),B(o,u),B(o,m),B(m,h)},p(e,t){e.currentCard&&p!==(p=t.currentCard.prompt)&&J(r,p),e.visibleAnswer&&J(i,t.visibleAnswer),(e.hintLevel||e.wordsAreLeftToDisplay)&&c!==(c=0===t.hintLevel||!t.wordsAreLeftToDisplay)&&(d.dataset.hidden=c),e.hiddenAnswer&&J(h,t.hiddenAnswer)},d(e){e&&(U(n),U(s),U(o))}}}// (7:2) {#if sheet.rows.length === 0}
function We(){var e;return{c(){e=K("h2"),e.textContent="This sheet doesn't have any rows!"},m(t,n){R(t,e,n)},p:V,d(t){t&&U(e)}}}function Fe(e){ne(this,e),this._state=Q(Ie(),e.data),this._recompute({currentQuestionPosition:1,sheet:1,workbook:1,currentCard:1,hintLevel:1,answerIsFullyVisible:1,answerWords:1,numberOfHintWords:1},this._state),this._intro=!0,document.getElementById("svelte-123h2zb-style")||je(),this._fragment=ze(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor))}var He=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},De=o,Ve=new RegExp("(\\\\.)|([\\/.])?(?:\\:(\\w+)(?:\\(((?:\\\\.|[^)])*)\\))?|\\(((?:\\\\.|[^)])*)\\))([+*?])?|([.+*?=^!:${}()[\\]|\\/])","g"),Qe="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,Be=i(function(e){/**
	 * Constructor to create a storage for our `EE` objects.
	 * An `Events` instance is a plain object whose properties are event names.
	 *
	 * @constructor
	 * @api private
	 */function t(){}//
// We try to not inherit from `Object.prototype`. In some engines creating an
// instance in this way is faster than calling `Object.create(null)` directly.
// If `Object.create(null)` is not supported we prefix the event names with a
// character to make sure that the built-in object properties are not
// overridden or used as an attack vector.
//
/**
	 * Representation of a single event listener.
	 *
	 * @param {Function} fn The listener function.
	 * @param {Mixed} context The context to invoke the listener with.
	 * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
	 * @constructor
	 * @api private
	 */function n(e,t,n){this.fn=e,this.context=t,this.once=n||!1}/**
	 * Minimal `EventEmitter` interface that is molded against the Node.js
	 * `EventEmitter` interface.
	 *
	 * @constructor
	 * @api public
	 */function a(){this._events=new t,this._eventsCount=0}/**
	 * Return an array listing the events for which the emitter has registered
	 * listeners.
	 *
	 * @returns {Array}
	 * @api public
	 */var r=Object.prototype.hasOwnProperty,s="~";/**
	 * Return the listeners registered for a given event.
	 *
	 * @param {String|Symbol} event The event name.
	 * @param {Boolean} exists Only check if there are listeners.
	 * @returns {Array|Boolean}
	 * @api public
	 */ /**
	 * Calls each of the listeners registered for a given event.
	 *
	 * @param {String|Symbol} event The event name.
	 * @returns {Boolean} `true` if the event had listeners, else `false`.
	 * @api public
	 */ /**
	 * Add a listener for a given event.
	 *
	 * @param {String|Symbol} event The event name.
	 * @param {Function} fn The listener function.
	 * @param {Mixed} [context=this] The context to invoke the listener with.
	 * @returns {EventEmitter} `this`.
	 * @api public
	 */ /**
	 * Add a one-time listener for a given event.
	 *
	 * @param {String|Symbol} event The event name.
	 * @param {Function} fn The listener function.
	 * @param {Mixed} [context=this] The context to invoke the listener with.
	 * @returns {EventEmitter} `this`.
	 * @api public
	 */ /**
	 * Remove the listeners of a given event.
	 *
	 * @param {String|Symbol} event The event name.
	 * @param {Function} fn Only remove the listeners that match this function.
	 * @param {Mixed} context Only remove the listeners that have this context.
	 * @param {Boolean} once Only remove one-time listeners.
	 * @returns {EventEmitter} `this`.
	 * @api public
	 */ /**
	 * Remove all listeners, or those of the specified event.
	 *
	 * @param {String|Symbol} [event] The event name.
	 * @returns {EventEmitter} `this`.
	 * @api public
	 */ //
// Alias methods names because people roll like that.
//
//
// This function doesn't apply anymore.
//
//
// Expose the prefix.
//
//
// Allow `EventEmitter` to be imported as module namespace.
//
Object.create&&(t.prototype=Object.create(null),!new t().__proto__&&(s=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e,t){var n=s?s+e:e,a=this._events[n];if(t)return!!a;if(!a)return[];if(a.fn)return[a.fn];for(var r=0,o=a.length,d=Array(o);r<o;r++)d[r]=a[r].fn;return d},a.prototype.emit=function(e,t,n,a,r,o){var d=s?s+e:e;if(!this._events[d])return!1;var l,c,u=this._events[d],m=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),m){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,a),!0;case 5:return u.fn.call(u.context,t,n,a,r),!0;case 6:return u.fn.call(u.context,t,n,a,r,o),!0;}for(c=1,l=Array(m-1);c<m;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),m){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,a);break;default:if(!l)for(h=1,l=Array(m-1);h<m;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l);}}return!0},a.prototype.on=function(e,t,a){var r=new n(t,a||this),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},a.prototype.once=function(e,t,a){var r=new n(t,a||this,!0),o=s?s+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},a.prototype.removeListener=function(e,n,a,r){var o=s?s+e:e;if(!this._events[o])return this;if(!n)return 0==--this._eventsCount?this._events=new t:delete this._events[o],this;var d=this._events[o];if(d.fn)d.fn!==n||r&&!d.once||a&&d.context!==a||(0==--this._eventsCount?this._events=new t:delete this._events[o]);else{for(var l=0,c=[],u=d.length;l<u;l++)(d[l].fn!==n||r&&!d[l].once||a&&d[l].context!==a)&&c.push(d[l]);//
// Reset the array, or remove it completely if we have no more listeners.
//
c.length?this._events[o]=1===c.length?c[0]:c:0==--this._eventsCount?this._events=new t:delete this._events[o]}return this},a.prototype.removeAllListeners=function(e){var n;return e?(n=s?s+e:e,this._events[n]&&(0==--this._eventsCount?this._events=new t:delete this._events[n])):(this._events=new t,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=s,a.EventEmitter=a,e.exports=a}),Re=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})},Ue=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable,$e=function(){var e=String.fromCharCode;try{if(!Object.assign)return!1;// Detect buggy property enumeration order in older V8 versions.
// https://bugs.chromium.org/p/v8/issues/detail?id=4118
var t=new String("abc");// eslint-disable-line no-new-wrappers
if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;// https://bugs.chromium.org/p/v8/issues/detail?id=3056
for(var a={},r=0;10>r;r++)a["_"+e(r)]=r;var n=Object.getOwnPropertyNames(a).map(function(e){return a[e]});if("0123456789"!==n.join(""))return!1;// https://bugs.chromium.org/p/v8/issues/detail?id=3056
var s={};return["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t"].forEach(function(e){s[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(e){// We don't expect any of the above to throw, but better to be safe.
return!1}}()?Object.assign:function(e){for(var t,n,a=d(e),r=1;r<arguments.length;r++){for(var o in t=Object(arguments[r]),t)qe.call(t,o)&&(a[o]=t[o]);if(Ue){n=Ue(t);for(var l=0;l<n.length;l++)Ke.call(t,n[l])&&(a[n[l]]=t[n[l]])}}return a},Me={extract:function(e){return e.split("?")[1]||""},parse:function(e,t){t=$e({arrayFormat:"none"},t);var n=c(t),a=Object.create(null);// Create an object with no prototype
// https://github.com/sindresorhus/query-string/issues/47
return"string"==typeof e?(e=e.trim().replace(/^(\?|#|&)/,""),!e)?a:(e.split("&").forEach(function(e){var t=e.replace(/\+/g," ").split("="),r=t.shift(),s=0<t.length?t.join("="):void 0;// Firefox (pre 40) decodes `%3D` to `=`
// https://github.com/sindresorhus/query-string/pull/37
s=void 0===s?null:decodeURIComponent(s),n(decodeURIComponent(r),s,a)}),Object.keys(a).sort().reduce(function(e,t){var n=a[t];return e[t]=!n||"object"!=typeof n||Array.isArray(n)?n:m(n),e},Object.create(null))):a},stringify:function(e,t){t=$e({encode:!0,strict:!0,arrayFormat:"none"},t);var n=l(t);return e?Object.keys(e).sort().map(function(a){var r=e[a];if(r===void 0)return"";if(null===r)return u(a,t);if(Array.isArray(r)){var s=[];return r.slice().forEach(function(e){void 0===e||s.push(n(a,e,s.length))}),s.join("&")}return u(a,t)+"="+u(r,t)}).filter(function(e){return 0<e.length}).join("&"):""}},Ge=function(){for(var e,t={},n=0;n<arguments.length;n++)for(var a in e=arguments[n],e)Ye.call(e,a)&&(t[a]=e[a]);return t},Ye=Object.prototype.hasOwnProperty,Je=function(e){function t(t){return function(n){n!==a&&t(e,n)}}var n=new Be,a="",r=v();return e.addEventListener("hashchange",function(){a!==n.get()&&(a=n.get(),n.emit("hashchange"))}),n.go=t(f),n.replace=t(h),n.get=g.bind(null,e,r),n},Xe=/^([^#]*)(:?#.*)?$/,Ze=function(e){var t=De(e);// The only reason I'm returning a new object instead of the results of the pathToRegexp
// function is so that if the official implementation ends up returning an
// allTokens-style array via some other mechanism, I may be able to change this file
// without having to change the rest of the module in index.js
return{regex:t,allTokens:t.allTokens}},et=Me.stringify,tt=T(function(e){function t(t){var a={};return n.forEach(function(n){a[n]=e[n][t]}),a}var n=Object.keys(e);n.forEach(function(t){if(!Array.isArray(e[t]))throw new Error(t+" is not an array")});for(var a=n.reduce(function(t,n){var a=e[n].length;return t>a?t:a},0),r=[],s=0;s<a;++s)r.push(t(s));return r}),nt=T(De),at=T(function(e){return function(){var t=this,n=Array.prototype.slice.call(arguments);return new Promise(function(a,r){n.push(function(e,t){e?r(e):a(t)});var s=e.apply(t,n),o=s&&("object"==typeof s||"function"==typeof s)&&"function"==typeof s.then;o&&a(s)})}}),rt=T(Be),st=T(function(e,t){function n(e,t){r.emit("not found",e,t)}function a(){t.removeListener("hashchange",o)}var r=new Be;S(e)&&(t=e,e=null),e=e||{},t||(t=Je(window));var s=[],o=k.bind(null,s,t,!!e.reverse,n);return t.on("hashchange",o),r.add=C.bind(null,s),r.stop=a,r.evaluateCurrent=A.bind(null,s,t,!!e.reverse,n),r.replace=t.replace,r.go=t.go,r.location=t,r}),ot=T(function(e,t){var n="string"==typeof e?Ze(e):e,a=n.allTokens,r=n.regex;if(t){var s=a.map(function(n){if(n.string)return n.string;var a="undefined"!=typeof t[n.name];if(!n.optional&&!a)throw new Error("Must supply argument "+n.name+" for path "+e);return a?n.delimiter+encodeURIComponent(t[n.name]):""}).join("");if(!r.test(s))throw new Error("Provided arguments do not match the original arguments");return N(s,t,a)}return n}),it=T(function(e){"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}),dt=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){e.exports=function(e){return e.split(".").reduce(function(e,t){return e.push(e.length?e[e.length-1]+"."+t:t),e},[])}}),lt=function(){function e(e){var t=dt(e);return t.map(function(e){if(!a[e])throw new Error("State "+e+" not found");return a[e]})}function t(e){var t=dt(e);if(1<t.length){var n=t.length-2;return t[n]}return null}function n(e){var t=a[e],r=t&&("function"==typeof t.defaultChild?t.defaultChild():t.defaultChild);if(!r)return e;return n(e+"."+r)}var a={};return{add:function(e,t){a[e]=t},get:function(e){return e&&a[e]},getHierarchy:e,getParent:function(e){var n=t(e);return n&&a[n]},getParentName:t,guaranteeAllStatesExist:function(e){var t=dt(e),n=t.filter(function(e){return!a[e]});if(0<n.length)throw new Error("State "+n[n.length-1]+" does not exist")},buildFullStateRoute:function(t){return e(t).map(function(e){return"/"+(e.route||"")}).join("").replace(/\/{2,}/g,"/")},applyDefaultChildStates:n}},ct=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(t))},ut=function(e){var t=I(),n=function(n){return j(ct(n,{stateState:e,getPathParameters:t}))};return function(e){return z(ct(e,{parametersChanged:n}))}},mt=function(){var e={name:"",parameters:{}};return{get:function(){return e},set:function(t,n){e={name:t,parameters:n}}}},ht=function(e){var t=!1,n=!1,a={destroy:[],change:[],create:[]};return e.forEach(function(e){t=t||e.stateParametersChanged,n=n||e.stateNameChanged,e.nameBefore&&(n?a.destroy.push(e.nameBefore):t&&a.change.push(e.nameBefore)),e.nameAfter&&n&&a.create.push(e.nameAfter)}),a},pt=function(e){function t(){s=null,o&&n()}function n(){s=o,o=null,s.beginStateChange()}function a(){s.transition.cancelled=!0;var t=new Error("State transition cancelled by the state transition manager");t.wasCancelledBySomeoneElse=!0,e.emit("stateChangeCancelled",t)}function r(e){var t={cancelled:!1,cancellable:!0};return{transition:t,beginStateChange:function(){for(var n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];return e.apply(void 0,[t].concat(a))}}}var s=null,o=null,i=function(){return!!s};e.on("stateChangeAttempt",function(e){o=r(e),i()&&s.transition.cancellable?a():!i()&&n()}),e.on("stateChangeError",t),e.on("stateChangeCancelled",t),e.on("stateChangeEnd",t)},ft={reverse:!1},gt=function(e,t){var n=Promise.resolve();return Promise.all(e.map(function(a,r){return n=n.then(function(){return t(a,r,e)})}))},yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt=function(e){return function(t){return t[e]}},kt=function(e){return e.slice().reverse()},bt=function(e){return function(t){return"function"==typeof t[e]}},_t=function(e){return e&&("object"===("undefined"==typeof e?"undefined":yt(e))||"function"==typeof e)&&"function"==typeof e.then},wt=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return new Promise(function(t){return t(e.apply(void 0,n))})},xt=["name","route","defaultChild","data","template","resolve","activate","querystringParameters","defaultQuerystringParameters","defaultParameters"],Ct=i(function(e){(function(t,n){e.exports=n()})(Qe,function(){function t(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function n(e){return Array.isArray(e)?[]:{}}function a(e,a){var r=a&&!0===a.clone;return r&&t(e)?o(n(e),e,a):e}function r(n,r,s){var d=n.slice();return r.forEach(function(r,e){"undefined"==typeof d[e]?d[e]=a(r,s):t(r)?d[e]=o(n[e],r,s):-1===n.indexOf(r)&&d.push(a(r,s))}),d}function s(e,n,r){var s={};return t(e)&&Object.keys(e).forEach(function(t){s[t]=a(e[t],r)}),Object.keys(n).forEach(function(i){s[i]=t(n[i])&&e[i]?o(e[i],n[i],r):a(n[i],r)}),s}function o(e,t,n){var o=Array.isArray(t),i=(n||{arrayMerge:r}).arrayMerge||r;return o?Array.isArray(e)?i(e,t,n):a(t,n):s(e,t,n)}return o.all=function(e,t){if(!Array.isArray(e)||2>e.length)throw new Error("first argument should be an array with at least two elements");// we are sure there are at least 2 values, so it is safe to have no initial value
return e.reduce(function(e,n){return o(e,n,t)})},o})}),At={destroy:function(e){this.destroy=V,this.fire("destroy"),this.set=V,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:ee,on:function(e,t){var n=this._handlers[e]||(this._handlers[e]=[]);return n.push(t),{cancel:function(){var e=n.indexOf(t);~e&&n.splice(e,1)}}},set:function(e){this._set(Q({},e));this.root._lock||te(this.root)},_recompute:V,_set:function(e){var t=this._state,n={},a=!1;for(var r in e=Q(this._staged,e),this._staged={},e)this._differs(e[r],t[r])&&(n[r]=a=!0);a&&(this._state=Q(Q({},t),e),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:t}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:t})))},_stage:function(e){Q(this._staged,e)},_mount:function(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)},_differs:function(e,t){return e==e?e!==t||e&&"object"==typeof e||"function"==typeof e:t==t}},Et={buildIndexUrl:function(e){return"https://spreadsheets.google.com/feeds/worksheets/"+e+"/public/basic?alt=json"},buildSheetUrl:function(e,t){return"https://spreadsheets.google.com/feeds/list/"+e+"/"+t+"/public/values?alt=json"}},St=function(e){return Object.getOwnPropertyNames(e).map(function(t){return[t,e[t]]})},Pt=function(){function e(e,t){var n=[],a=!0,r=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(n.push(o.value),!(t&&n.length===t));a=!0);}catch(e){r=!0,s=e}finally{try{!a&&i["return"]&&i["return"]()}finally{if(r)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Nt=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){var t=Et.buildIndexUrl,n=Et.buildSheetUrl;e.exports=function(e){return{getWorkbook:function(n){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:e;return o(t(n)).then(function(e){var t=e.feed,n=t.entry.map(function(e){var t=e.link.find(function(e){return"self"===e.rel}).href;return{name:a(e.title),id:s(t),updated:a(e.updated)}});return{name:a(t.title),updated:a(t.updated),authors:r(t),sheets:n}})},getSheet:function(t,s){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:e;return o(n(t,s)).then(function(e){var t=e.feed,n=t.entry.map(function(e){var t=St(e).filter(function(e){var t=Pt(e,1),n=t[0];return /^gsx\$/.test(n)}).map(function(e){var t=Pt(e,2),n=t[0],r=t[1];return{key:n.replace("gsx$",""),value:a(r)}}),n=t.map(function(e){var t=e.value;return t});return t.filter(function(e){var t=e.key;return /^[^_]/.test(t)}).forEach(function(e){var t=e.key,a=e.value;n[t]=a}),n});return{name:a(t.title),updated:a(t.updated),authors:r(t),rows:n}})},urlToKey:function(e){return o(/key=(.*?)(&|#|$)/,e)||o(/d\/(.*?)\/pubhtml/,e)||o(/spreadsheets\/d\/(.*?)\//,e)||i("No key found in "+e)}}};var a=function(e){return e.$t},r=function(e){return e.author.map(function(e){var t=e.name,n=e.email;return{name:a(t),email:a(n)}})},s=function(e){return e.split("/").pop()},o=function(e,t){var n=e.exec(t);return n&&n[1]},i=function(e){throw new Error(e)}}),Lt=Nt(function(e){var t=Object.assign({method:"GET",success:re,parse:oe,serialize:se,headers:{}},e);return function(e,n){return new Promise(function(a,r){var s=new XMLHttpRequest;s.addEventListener("load",function(){try{var e=t.parse(s);t.success(s)?a(e):r(e)}catch(t){r(t)}}),s.addEventListener("error",r),s.addEventListener("abort",r),s.open(t.method,e),Object.keys(t.headers).forEach(function(e){s.setRequestHeader(e,t.headers[e])}),"undefined"==typeof n?s.send():s.send(t.serialize(n))})}}()),Tt=Lt;/* client/view/index/Index.html generated by Svelte v2.16.0 */const{urlToKey:It}=Tt;var jt={loadSheet(e){try{const t=It(e);this.mediatorCall(`stateGo`,`workbook`,{key:t})}catch(e){this.set({error:e})}}};Q(ce.prototype,At),Q(ce.prototype,jt);Q(he.prototype,At);Q(fe.prototype,At);Q(_e.prototype,At);Q(xe.prototype,At);var zt={goToNextCard(){const{currentQuestionPosition:e,cardsInSheet:t}=this.get(),n=e+1;this.set({currentQuestionPosition:n>=t?0:n,answerIsFullyVisible:!1,hintLevel:0})},keydown({key:e}){` `===e?this.get().answerIsFullyVisible?this.goToNextCard():this.set({answerIsFullyVisible:!0}):(`h`===e||`H`===e)&&(this.set({hintLevel:this.get().hintLevel+1}),!this.get().wordsAreLeftToDisplay&&this.set({answerIsFullyVisible:!0}))}};Q(Fe.prototype,At),Q(Fe.prototype,zt),Fe.prototype._recompute=function(e,t){(e.currentQuestionPosition||e.sheet)&&this._differs(t.currentCard,t.currentCard=Ce(t))&&(e.currentCard=!0),e.sheet&&this._differs(t.cardsInSheet,t.cardsInSheet=Ae(t))&&(e.cardsInSheet=!0),(e.sheet||e.workbook)&&this._differs(t.displayHeader,t.displayHeader=Ee(t))&&(e.displayHeader=!0),e.currentCard&&this._differs(t.answerWords,t.answerWords=Se(t))&&(e.answerWords=!0),e.hintLevel&&this._differs(t.numberOfHintWords,t.numberOfHintWords=Pe(t))&&(e.numberOfHintWords=!0),(e.answerIsFullyVisible||e.currentCard||e.answerWords||e.numberOfHintWords)&&this._differs(t.visibleAnswer,t.visibleAnswer=Ne(t))&&(e.visibleAnswer=!0),(e.answerIsFullyVisible||e.answerWords||e.numberOfHintWords)&&this._differs(t.hiddenAnswer,t.hiddenAnswer=Le(t))&&(e.hiddenAnswer=!0),(e.answerIsFullyVisible||e.numberOfHintWords||e.answerWords)&&this._differs(t.wordsAreLeftToDisplay,t.wordsAreLeftToDisplay=Te(t))&&(e.wordsAreLeftToDisplay=!0)};const Ot=function(){const e=Object.create(null);return{provide(t,n){if(`function`!=typeof n)throw new Error(`${n} is not a function`);else if(`string`!=typeof t)throw new Error(`The provider name must be a string`);else if(e[t])throw new Error(`There is already a provider for "${t}"`);else e[t]=n;let a=!1;return()=>{a||(delete e[t],a=!0)}},call(t,...n){if(e[t])return e[t](...n);throw new Error(`No provider found for "${t}"`)}}}(),Wt=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return function(t){function n(n,r){function s(e,t){return t.methods?H(e,t,t.methods):new e(t)}function o(){u.set({asr:a})}var i=n.element,d=n.template,l=n.content,c=Ct(e,{target:i,data:Object.assign(l,e.data,{asr:a})}),u=void 0;try{if("function"==typeof d)u=s(d,c);else{var m=Ct(c,d.options);u=s(d.component,m)}}catch(t){return void r(t)}t.on("stateChangeEnd",o),u.on("destroy",function(){t.removeListener("stateChangeEnd",o)}),u.mountedToTarget=i,r(null,u)}var a={makePath:t.makePath,stateIsActive:t.stateIsActive};return{render:n,reset:function(e,t){var a=e.domApi,r=a.mountedToTarget;a.destroy();var s=Object.assign({element:r},e);n(s,t)},destroy:function(e,t){e.destroy(),t()},getChildElement:function(e,t){try{var n=e.mountedToTarget,a=n.querySelector("uiView");t(null,a)}catch(n){t(n)}}}}}({methods:{mediatorCall:Ot.call}}),Ft=function(e,t){function n(e,t){it(function(){if(y.emit(e,t),console.error(e+" - "+t.message),_)throw t})}function a(e){var t=p.get(e);return y.emit("beforeDestroyState",{state:t,domApi:N[e]}),L[e].emit("destroy"),L[e].removeAllListeners(),delete L[e],delete P[e],C(N[e]).then(function(){delete N[e],y.emit("afterDestroyState",{state:t})})}function r(e,t){var n=N[t],a=O(P,t),r=p.get(t);return y.emit("beforeResetState",{domApi:n,content:a,state:r,parameters:e}),L[t].emit("destroy"),delete L[t],S({domApi:n,content:a,template:r.template,parameters:e}).then(function(n){n&&(N[t]=n),y.emit("afterResetState",{domApi:N[t],content:a,state:r,parameters:e})})}function s(e){return new Promise(function(n){var a=p.getParent(e);if(a){var r=N[a.name];n(A(r))}else n(t)})}function o(e,t){return s(t).then(function(n){var a=p.get(t),r=O(P,t);return y.emit("beforeCreateState",{state:a,content:r,parameters:e}),E({template:a.template,element:n,content:r,parameters:e}).then(function(n){return N[t]=n,y.emit("afterCreateState",{state:a,domApi:n,content:r,parameters:e}),n})})}function i(e,t){return gt(e,function(e){return o(t,e)})}function d(e,t){try{var a=p.applyDefaultChildStates(e.name);if(a===e.name)c(a,t);else{// There are default child states that need to be applied
var r=m(a,t),s=x.location.get();r===s?c(a,t):y.go(a,t,{replace:!0})}}catch(e){n("stateError",e)}}function l(e){return e.change.concat(e.create).map(p.get)}function c(e,t){y.emit("stateChangeAttempt",function(n){u(e,t,n)})}function u(e,t,s){function o(t){return function(){if(s.cancelled){var n=new Error("The transition to "+e+" was cancelled");throw n.wasCancelledBySomeoneElse=!0,n}else return t.apply(void 0,arguments)}}return wt(p.guaranteeAllStatesExist,e).then(function(){var n=p.get(e),a=n.defaultParameters||n.defaultQuerystringParameters||{},r=Object.keys(a).some(function(e){return"undefined"==typeof t[e]});if(r)throw W(e,ct(a,t));return n}).then(o(function(e){y.emit("stateChangeStart",e,t,k(e.name)),g.set(e.name,t)})).then(function(){var n=v({original:f.get(),destination:{name:e,parameters:t}});return ht(n);// { destroy, change, create }
}).then(o(function(e){function n(e){return e.map(p.get).forEach(function(e){var n=new rt,a=Object.create(n);a.domApi=N[e.name],a.data=e.data,a.parameters=t,a.content=O(P,e.name),L[e.name]=n;try{e.activate&&e.activate(a)}catch(t){it(function(){throw t})}})}return F(l(e),ct(t)).catch(function(t){throw t.stateChangeError=!0,t}).then(o(function(o){s.cancellable=!1;var d=function(){return n(e.change.concat(e.create))};return P=ct(P,o),gt(kt(e.destroy),a).then(function(){return gt(kt(e.change),function(e){return r(ct(t),e)})}).then(function(){return i(e.create,ct(t)).then(d)})}))})).then(function(){f.set(e,t);try{y.emit("stateChangeEnd",p.get(e),t,k(e))}catch(t){n("stateError",t)}}).catch(o(function(e){return e&&e.redirectTo?(y.emit("stateChangeCancelled",e),y.go(e.redirectTo.name,e.redirectTo.params,{replace:!0})):void(e&&n("stateChangeError",e))})).catch(function(e){if(e&&e.wasCancelledBySomeoneElse);else throw new Error("This probably shouldn't happen, maybe file an issue or something "+e)})}function m(e,t,n){function a(){if(!g.get().name)throw new Error("makePath required a previous state to exist, and none was found");return g.get()}n&&n.inherit&&(t=ct(a().parameters,t));var r=null===e?a().name:e,s=p.get(r)||{},o=s.defaultParameters||s.defaultQuerystringParameters;t=ct(o,t),p.guaranteeAllStatesExist(r);var i=p.buildFullStateRoute(r);return ot(i,t||{})}var h=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},p=lt(),f=mt(),g=mt(),y=new rt,v=ut(p),k=function(e){return dt(e).map(p.get)};pt(y);var b=ct({throwOnError:!0,pathPrefix:"#"},h),_=b.throwOnError,w=b.pathPrefix,x=h.router||st(ft);x.on("not found",function(e,t){y.emit("routeNotFound",e,t)});var C=null,A=null,E=null,S=null,P={},N={},L={},T={replace:!1};y.addState=function(e){if("undefined"==typeof e)throw new Error("Expected 'state' to be passed in.");else if("undefined"==typeof e.name)throw new Error("Expected the 'name' option to be passed in.");else if("undefined"==typeof e.template)throw new Error("Expected the 'template' option to be passed in.");Object.keys(e).filter(function(e){return-1===xt.indexOf(e)}).forEach(function(e){console.warn("Unexpected property passed to addState:",e)}),p.add(e.name,e);var t=p.buildFullStateRoute(e.name);x.add(t,function(t){return d(e,t)})},y.go=function(e,t,a){a=ct(T,a);var r=a.replace?x.replace:x.go;return wt(m,e,t,a).then(r,function(e){return n("stateChangeError",e)})},y.evaluateCurrentRoute=function(e,t){return wt(m,e,t).then(function(e){x.evaluateCurrent(e)}).catch(function(e){return n("stateError",e)})},y.makePath=function(e,t,n){return w+m(e,t,n)},y.getActiveState=function(){return f.get()},y.stateIsActive=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=f.get(),a=n.name===e||0===n.name.indexOf(e+".");return a&&(!t||Object.keys(t).every(function(e){return t[e]===n.parameters[e]}))};var I=e(y);return C=at(I.destroy),A=at(I.getChildElement),E=at(I.render),S=at(I.reset),y}(Wt,document.getElementById(`app-target`));Ot.provide(`stateGo`,Ft.go),Ot.provide(`onStateRouter`,(e,t)=>{Ft.on(e,t)});const Ht=[e=>{e.provide("getWorkbook",Tt.getWorkbook),e.provide("getSheet",Tt.getSheet)}].map(e=>e(Ot));[()=>({name:`index`,route:`home`,template:ce}),()=>({name:`not-found`,route:`not-found`,querystringParameters:[`route`,`parameters`],template:he,async resolve(e,t){return t}}),e=>({name:`workbook`,defaultChild:`select-sheet`,route:`workbook/:key`,template:fe,async resolve(t,{key:n}){const a=await e.call(`getWorkbook`,n);return{workbook:a,key:n}}}),e=>({name:`workbook.select-sheet`,route:`select`,template:_e,async resolve(e,{key:t}){return{key:t}},activate({content:t,parameters:n}){1===t.workbook.sheets.length&&e.call(`stateGo`,`workbook.sheet.memorize`,{key:n.key,sheetId:t.workbook.sheets[0].id},{replace:!0,inherit:!0})}}),e=>({name:`workbook.sheet`,route:`sheet/:sheetId`,defaultChild:`memorize`,template:xe,async resolve(t,{key:n,sheetId:a}){const r=await e.call(`getSheet`,n,a);return{sheet:r,sheetId:a}}}),()=>({name:`workbook.sheet.memorize`,route:`memorize`,template:Fe})].map(e=>e(Ot)).forEach(Ft.addState),Ft.on(`routeNotFound`,e=>{Ft.go(`not-found`,{route:e},{replace:!0})}),Ft.on(`stateChangeStart`,(e,t)=>console.log(`stateChangeStart`,e.name,t)),Ft.on(`stateChangeError`,e=>console.error(`stateChangeError`,e)),Ft.on(`stateError`,e=>console.error(`stateError`,e)),Ft.on(`stateChangeEnd`,(e,t)=>console.log(`stateChangeEnd`,e.name,t));const Dt=function(e){function t(e){var t=e.state,n=e.domApi;a[t.name]=n,r.forEach(function(e){return e(n)})}function n(e){var t=e.state,n=e.domApi;a[t.name]||console.error("detaching, but no current dom api for that name was found"),s.forEach(function(e){return e(n)}),delete a[t.name]}var a={},r=[],s=[];return e.on("afterCreateState",t),e.on("afterResetState",t),e.on("beforeResetState",n),e.on("beforeDestroyState",n),{addDomApiAttachListener:function(e){return Object.keys(a).forEach(function(t){return e(a[t])}),D(r,e)},addDomApiDetachListener:function(e){return D(s,e)}}}(Ft);Dt.addDomApiAttachListener(e=>{e.onStateInit&&e.onStateInit()}),Dt.addDomApiDetachListener(e=>{e.onStateCleanup&&e.onStateCleanup()}),Promise.all(Ht).then(()=>{Ft.evaluateCurrentRoute(`index`)})})();
//# sourceMappingURL=build.js.map
